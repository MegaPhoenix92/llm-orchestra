# LLM Orchestra Agent Guide

## ðŸš¨ AgentCoord (Local File-Based Coordination)

AgentCoord enables multiple AI agents (Claude, Codex, Gemini, etc) to collaborate safely on this repo using **file-based state** and **automatic retention**.

**Storage**: `.agent-state/` (gitignored)
- `agents/` - agent registration + heartbeat
- `tasks/` - tasks + claim status
- `messages/` - inter-agent messaging (ping/broadcast/inbox)

### Quick Start

```typescript
import { AgentCoord } from './src/agents';

// Initialize
const coord = new AgentCoord({ agentName: 'claude' }); // or 'gemini', 'codex'
await coord.init();

// Send heartbeat
await coord.heartbeat('Working on provider adapters');

// Check who's working
const { active, busy } = await coord.whoIsWorking();

// Check inbox
const messages = await coord.getInbox();

// List tasks
const tasks = await coord.listTasks({ status: 'pending' });
```

### CLI Commands (if available)

```bash
export AGENT_ID=<your-name>
npm run agent:heartbeat
npm run agent:inbox
npm run agent:who
npm run agent:tasks
```

**Automatic cleanup:** AgentCoord prunes `.agent-state/` on every heartbeat (TTL-based).

## ðŸ”„ Mandatory PR Review Process with @codex and Copilot

### CRITICAL: Every Commit Must Be Reviewed

**ALL agents (Claude, Codex, Gemini, etc.) must request code review from @codex and GitHub Copilot before merging ANY changes.**

### PR Review Workflow for All Agents

#### Step 1: Create Feature Branch and Commit
```bash
git checkout -b feat/your-feature-name
git add .
git commit -m "feat: description

Co-Authored-By: [Your Agent Name] <noreply@example.com>"
```

#### Step 2: Push and Create PR
```bash
git push -u origin feat/your-feature-name
gh pr create --title "feat: your feature" --body "## Summary
- Changes description

## Test plan
- [ ] Tests pass

ðŸ¤– Generated by [Agent Name]"
```

#### Step 3: Request Code Reviews (MANDATORY)
```bash
# Get PR number
PR_NUM=$(gh pr view --json number -q '.number')

# Request @codex review
gh pr comment $PR_NUM --body "@codex please review this PR"

# Open in browser to request Copilot review
gh pr view --web
# In GitHub UI: Click "Reviewers" â†’ Add "GitHub Copilot"
```

#### Step 4: Address Feedback and Merge
```bash
# Check status
gh pr checks

# Fix issues and push
git add . && git commit -m "fix: address review feedback" && git push

# Merge after BOTH approve
gh pr merge --squash --delete-branch
```

### Review Checklist (All Agents)
- [ ] Tests pass (`npm test`)
- [ ] No lint errors (`npm run lint`)
- [ ] Code follows conventions
- [ ] No secrets committed
- [ ] @codex review requested
- [ ] Copilot review requested
- [ ] All feedback addressed

### Agent-Specific Co-Author Tags
```
Claude:  Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
Codex:   Co-Authored-By: GitHub Codex <noreply@github.com>
Gemini:  Co-Authored-By: Gemini <noreply@google.com>
```

## Project-Specific Notes

### Key Areas

| Area | Primary Agent | Files |
|------|--------------|-------|
| Anthropic Provider | Claude | `src/providers/anthropic.ts` |
| Google Provider | Gemini | `src/providers/google.ts` |
| OpenAI Provider | Any | `src/providers/openai.ts` |
| Routing/Failover | Any | `src/routing/router.ts` |
| Tracing | Any | `src/tracing/tracer.ts` |
| Types | Any | `src/types/index.ts` |

### Development Commands

```bash
npm install      # Install dependencies
npm run build    # Build TypeScript
npm test         # Run tests
npx tsc --noEmit # Type check
```
